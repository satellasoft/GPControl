
$(document).ready(function(){var a=getCookie("result");DeleteCookie("result");if(a=="c1"){ShowModal("Sucesso","<span class='text-success'>Usuário cadastrado com sucesso.</span>")}else{if(a=="c2"){ShowModal("Erro","<span class='text-success'>Não foi possível cadastrar o usuário.</span>")}else{if(a=="e1"){ShowModal("Sucesso","<span class='text-success'>Usuário alterado com sucesso.</span>")}else{if(a=="e2"){ShowModal("Erro","<span class='text-success'>Não foi possível alterar o usuário.</span>")}}}}});$("#btnNovoUsuario").click(function(){$("#dvFormUsuario").toggle("slow")});$("#txtEmail").focusout(function(){ValidarEmail()});$("#frmGerenciaUsuario").submit(function(a){if(!Validar()){a.preventDefault()}});function Validar(){var c=0;var b=document.getElementById("ulErros");b.innerHTML="";if($("#txtNome").val().length<=3){var a=document.createElement("li");a.innerHTML="- Informe um nome válido. (min. 4 caracteres)";b.appendChild(a);c++}if(!ValidateEmail($("#txtEmail").val())){var a=document.createElement("li");a.innerHTML="- Informe um e-mail válido.";b.appendChild(a);c++}if($("#txtEditando").val()==0){if($("#txtSenha").val().length<7||$("#txtSenha").val().length>25){var a=document.createElement("li");a.innerHTML="- Informe uma senha válida. (min. 7 e max. 25 caracteres)";b.appendChild(a);c++}}if(c==0){return true}else{return false}}function Consultar(){if($("#txtBuscaNome").val().length>=3){var a={p:$("#slBuscaPermissao").val(),s:$("#slBuscaStatus").val(),n:$("#txtBuscaNome").val()};$.ajax({url:"App/Action/UsuarioAction.php?req=1",data:a,type:"post",dataType:"JSON",beforeSend:function(){$("#btnBuscar").prop("disabled",true)},success:function(b){MontarTabela(b)},error:function(b){ShowModal("ERRO","Houve um erro ao tentar fazer uma busca.");console.log(b)}});console.log(a)}else{ShowModal("ERRO","Informe ao menos três caracteres.")}}function MontarTabela(c){var a=document.getElementById("tbody");a.innerHTML="";for(var b=0;b<c.length;b++){var e="<tr><td>"+c[b].Nome+"</td><td>"+c[b].Email+"</td><td>"+c[b].Data+"</td><td><button onclick='ModalSenha("+c[b].Cod+")' class='btn btn-info margin-right'>Alterar senha</button><a href='?p=gusuario&cod="+c[b].Cod+"' class='btn btn-warning'>Editar</a></td></tr>";a.innerHTML+=e}}function ValidarEmail(){if(ValidateEmail($("#txtEmail").val())){var a={e:$("#txtEmail").val()};$.ajax({url:"App/Action/UsuarioAction.php?req=2",data:a,type:"post",dataType:"HTML",success:function(b){if(b==1){$("#btnCadastrar").prop("disabled",false);$("#txtEmail").css("border","1px solid green")}else{ShowModal("ATENÇÃO","O e-mail informado já está em uso.");$("#btnCadastrar").prop("disabled",true);$("#txtEmail").css("border","1px solid red")}console.log(b)},error:function(b){$("#btnCadastrar").prop("disabled",true);ShowModal("ERRO","Houve um erro ao tentar verificar se o e-mail está em uso, atualize a página e tente novamente.");console.log(b)}})}else{$("#btnCadastrar").prop("disabled",true);$("#txtEmail").css("border","1px solid red");ShowModal("ATENÇÃO","Informe um e-mail válido")}}function ModalSenha(a){$("#modalSenha").modal("show");$("#txtCode").val(a)}function AlterarSenha(){if($("#txtNovaSenha").val().length>=7){$("#dvResultSenha").text("");var a={c:$("#txtCode").val(),s:$("#txtNovaSenha").val()};$.ajax({url:"App/Action/UsuarioAction.php?req=4",data:a,type:"post",dataType:"HTML",beforeSend:function(){$("#btnAlterarSenha").prop("disabled",true)},success:function(b){console.log(b);if(b==1){$("#btnAlterarSenha").prop("disabled",false);$("#dvResultSenha").prop("class","alert alert-success");$("#dvResultSenha").text("Senha alterada");$("#txtNovaSenha").val("")}else{$("#dvResultSenha").prop("class","alert alert-danger");$("#dvResultSenha").text("Não foi possível alterar a senha")}},error:function(b){console.log(b)}})}else{$("#dvResultSenha").text("Senha inválida, minímo 7 caracteres.")}}function ValidateEmail(a){var b=/\S+@\S+\.\S+/;return b.test(a)};